# Basic DSC

To quickly re-cap what you've might forgotten about DSC. We will create a simple configuration to enable you to get started

## First configuration

```powershell
Configuration InitialConfiguration {
    Import-DscResource â€œModuleName 'PSDesiredStateConfiguration'
    
    Node localhost {
        File TmpFolderMustExists {
            Type = 'Directory'
            Ensure = 'Present'
            Destination = 'C:\tmp'
        }
    }
}

InitialConfiguration
```

Run this configuration by running Start-DSCConfiguration. 

We'll go ahead and add some more features to the configuration


```powershell

<# Todo in workshop - WindowsFeature, Log #>
```
## Parameters
A simple configuration as the one above can only get you so far. By adding params to the configuration, we get a whole lot more flexibility. 


```powershell
<# Todo in workshop #>
```

## Lets take a look at the mofs
Let's take a look at the MOF being generated for a while.

## Configuration files

How does the configuration file really work? What's going on here? Let's take a look.

Create the following ConfigurationFile and name it NodeData.psd1

```powershell

<# Todo in workshop #>
```

Now import it into a variable by using Import-PowerShelldatafile and explore it's contents. 

We'll now create a extended configuration for the sake of this example using node configuration


```powershell

<# Todo in workshop #>
```

## How about credentials
Whediidn working with credentials and secure strings in a configuration, they should be encrypted. In order for this to work, we need to have a certificate installed and a public key for signing them. 
There's a few different ways we can generate and import certificates, the most common ones are:

- Create certificate on author node, export cert and private key with a password and import private key in target node
```powershell
# Create certificate on author
cert = New-SelfSignedCertificate -Type DocumentEncryptionCertLegacyCsp -DnsName 'DscEncryptionCert' -HashAlgorithm SHA256
$mypwd = ConvertTo-SecureString -String "YOUR_PFX_PASSWD" -Force -AsPlainText
$cert | Export-PfxCertificate -FilePath "$env:temp\DscPrivateKey.pfx" -Password $mypwd -Force
$cert | Export-Certificate -FilePath "$env:temp\DscPublicKey.cer" -Force
$cert | Remove-Item -Force
Import-Certificate -FilePath "$env:temp\DscPublicKey.cer" -CertStoreLocation Cert:\LocalMachine\My

# Import on target
$mypwd = ConvertTo-SecureString -String "YOUR_PFX_PASSWD" -Force -AsPlainText
Import-PfxCertificate -FilePath "$env:temp\DscPrivateKey.pfx" -CertStoreLocation Cert:\LocalMachine\Root -Password $mypwd > $null
```

- Create certificate on target node, export cert and copy this to author (or file share) 
```powershell
<# Todo in workshop #>
# Setting up certificates Create certificate on target 

$cert = New-SelfSignedCertificate -Type DocumentEncryptionCertLegacyCsp -DnsName 'DscEncryptionCert' -HashAlgorithm SHA256
$cert | Export-Certificate -FilePath "$env:temp\DscPublicKey.cer" -Force

# Then import on authoring
Import-Certificate -FilePath "$env:temp\DscPublicKey.cer" -CertStoreLocation Cert:\LocalMachine\My

# Reminder - Show Certificate and Thumbprint / PSDSCAllowPlainTextPassword / DomainCredentials
```





