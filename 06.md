# Azure Automation
First we'll show you some of what's available in Azure automation in the portal. 
Then, we'll show you how to utilize this from Powershell

## Login AzureRM
Make sure you're logged in to AzureRM
```powershell
Login-AzureRMAccount 
```
## Create Azure automation account
```powershell

<# Todo in workshop #>
```

## Create a simple configuration for pushing to Azure

```powershell

<# Todo in workshop #>
```
## Publish your document to Azure
```powershell

<# Todo in workshop #>
```

## Start Azure-compilationJob


```powershell

<# Todo in workshop #>
```

## Manage assets
Shown in portal. We will here create a credential called "myCredential" and we will show you how to import required modules for compilation to work.

## Passing data and credentials

How do you pass the data to Azure automation when starting the compilation job? 

```powershell

<# Todo in workshop #>
```


## Onboarding servers to Azure Automation for DSC pull

This can be done in multiple ways. We can onboard it in your ARM template : 


```powershell
<# Show in workshop #>
```

Add this extension to your ARM template
```json
{
          "type": "Microsoft.Compute/virtualMachines/extensions",
          "name": "[concat(variables('appServerName'), '-', copyIndex(1),'/Microsoft.Powershell.DSC')]",
          "apiVersion": "2015-06-15",
          "location": "[resourceGroup().location]",
          "dependsOn": [
            "[concat('Microsoft.Compute/virtualMachines/',variables('appServerName'),'-',copyIndex(1))]"
          ],
          "tags": {
            "displayName": "Desired State Configuration"            
          },
          "properties": {
            "publisher": "Microsoft.Powershell",
            "type": "DSC",
            "typeHandlerVersion": "2.19",
            "autoUpgradeMinorVersion": true,
            "protectedSettings": {
              "Items": {
                "registrationKeyPrivate": "[variables('selectedEnvironment').registrationKey]"
              }
            },
            "settings": {
              "ModulesUrl": "https://github.com/haraldfianbakken/azure-quickstart-templates/raw/master/201-vmss-automation-dsc/UpdateLCMforAAPull.zip",
              "SasToken": "",
              "ConfigurationFunction": "UpdateLCMforAAPull.ps1\\ConfigureLCMforAAPull",
              "Properties": [
                {
                  "Name": "RegistrationKey",
                  "Value": {
                    "UserName": "PLACEHOLDER_DONOTUSE",
                    "Password": "PrivateSettingsRef:registrationKeyPrivate"
                  },
                  "TypeName": "System.Management.Automation.PSCredential"
                },
                {
                  "Name": "RegistrationUrl",
                  "Value": "[variables('selectedEnvironment').registrationUrl]",
                  "TypeName": "System.String"
                },
                {
                  "Name": "ConfigurationMode",
                  "Value": "[parameters('configurationMode')]",
                  "TypeName": "System.String"
                },
                {
                  "Name": "ConfigurationModeFrequencyMins",
                  "Value": "[parameters('configurationModeFrequencyMins')]",
                  "TypeName": "System.Int32"
                },
                {
                  "Name": "RefreshFrequencyMins",
                  "Value": "[parameters('refreshFrequencyMins')]",
                  "TypeName": "System.Int32"
                },
                {
                  "Name": "RebootNodeIfNeeded",
                  "Value": "[parameters('rebootNodeIfNeeded')]",
                  "TypeName": "System.Boolean"
                },
                {
                  "Name": "ActionAfterReboot",
                  "Value": "[parameters('actionAfterReboot')]",
                  "TypeName": "System.String"
                },
                {
                  "Name": "AllowModuleOverwrite",
                  "Value": "[parameters('allowModuleOverwrite')]",
                  "TypeName": "System.Boolean"
                }
              ]
            }
          }
```

We can onboard it using Get-AzureRmAutomationDscOnboardingMetaconfig

```powershell
<# Show in workshop #>
```

We can onboard it manually using the LCM and fetching the keys registered in the portal (